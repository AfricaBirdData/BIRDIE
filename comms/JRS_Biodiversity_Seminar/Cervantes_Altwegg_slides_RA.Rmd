---
title: "Statistical models for the BIRDIE pipeline"
author: "Francisco Cervantes and Res Altwegg"
date: "7/07/2021"
subtitle: 'JRS Biodiversity Series'
output: beamer_presentation
classoption: "aspectratio=169"
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../output") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Data pipeline

One slide showing the data pipeline diagram to explain how this part fits into the pipeline

## The types of decisions that need to be supported

Perhaps a brief slide on what kind of decisions / reporting this information is meant to feed into. Unless Nancy / Francis are planning to cover this

## Objectives

\begin{itemize}
\item Estimate metrics such as:
    \begin{itemize}
    \item[-] distribution,
    \item[-] abundance,
    \item[-] population trend and,
    \item[-] species diversity.
    \end{itemize}
\item Integrate these metrics for different populations.
\item Model observation error.
\end{itemize}


## State-space models

\begin{itemize}
    \item Dynamic models describe how processes change.
    \item Account for observation error.
\end{itemize}

Include the typical HMM schematic plot describing state-space models??

Go on to say that the process we are interested on can take on different forms
such as population abundance or occupancy...

## State-space models (simpler syntax but same result)

- Dynamic models describe how processes change.
- Account for observation error.

Include the typical HMM schematic plot describing state-space models??

Go on to say that the process we are interested on can take on different forms
such as population abundance or occupancy...

## Observation error: abundance example

\begin{center}
\includegraphics[height=7.5cm]{"abund_obs.png"}
\end{center}

## Observation error: abundance example (more versatile syntax)

```{r observationerror, out.width="50%", include=TRUE, fig.align="center", echo=F, fig.cap = "Some figure legend, if needed..."}
knitr::include_graphics("abund_obs.png")
```

## The SSM

Are you still using Yahkat's model? She has a nice diagram that we could use to explain it. I think it would be good to explain how we can estimate summer and winter trends separately.

## some results

I think we should show some results slides here. Do you have some results ready? Otherwise, we can also show some of the figures from Yahkat or Birgit's papers.

## Observation error: occupancy example

\begin{center}
\includegraphics[height=7.5cm]{"occu_obs.png"}

\end{center}

## Occupancy models

\begin{columns}
\column{.5\textwidth}{
\includegraphics[width=\textwidth]{guru2017.png} 
}
{\footnotesize Guillera-Arroita 2017}
\column{.5\textwidth}{

Information about the observation process:\\

\vspace{0.5cm}

\includegraphics[width=\textwidth]{guru2017b.png} 
 }

\end{columns}


## Southern African Bird Atlas Project

\begin{columns}
\column{.3\textwidth}{
After 1 year
\includegraphics[width=\textwidth,angle=0]{sabap1year.png}
}
\column{.3\textwidth}{
After 5 years
\includegraphics[width=\textwidth,angle=0]{sabap5year.png}
}
\column{.3\textwidth}{
After 10 years
\includegraphics[width=\textwidth,angle=0]{sabap10year.png}
}
\end{columns}



## The species is not detected in all occupied cells
\begin{columns}[]
\column{0.6\textwidth}{
\includegraphics[height=6.5cm]{detections2.pdf}
}
\column{0.4\textwidth}{

Repeated sampling

\vspace{0.5cm}

{\bf Assumptions:}
\begin{itemize}
\item Closure (no colonisation or extinction)
\item No false detections
%\item No unmodelled heterogeneity
%\item Independence
\end{itemize}
}
\end{columns}

## Hierarchical model

$\Psi_i =$ probability that site $i$ is occupied

$z_i =$ true occupancy at site $i$: 1 = occupied, 0 = not occupied

$p_{ij} =$ prob of detecting the species at site $i$ during survey $j$

$y_{ij} =$ detection (1) or non-detection (0)  at site $i$ during survey $j$


\vspace{1cm}

$$z_i | \Psi_i \sim Bern(\Psi_i)$$

$$y_{ij} | z_i,p_{ij} \sim Bern(z_ip_{ij})$$


## Covariate modelling

Want to know how occupancy and detection vary among sites, $i$, and visits, $j$.

\vspace{0.5cm}

$logit(\Psi_i) = \alpha_0 + \alpha_1 x_{i1} + \ldots + \alpha_U x_{iU}$

$logit(p_{ij}) = \beta_0 + \beta_1 x_{i1} + \ldots + \beta_U x_{iU} + \beta_{U+1} y_{ij1} +\ldots + \beta_{U+V} y_{ijV}$

\vspace{0.5cm}

$U$ site-level covariates: $x_{i1}, \ldots, x_{iU}$

$V$ survey-specific covariates: $y_{ij1}, \ldots, y_{ijV}$

## Covariates we used:

\begin{columns}[T]
\column{.6\textwidth}{
Occupancy:

\vspace{0.5cm}

\includegraphics[width=\textwidth]{huntleycovariates.pdf}
}

\column{.4\textwidth}{
Detection:
\begin{itemize}
\item hours spent birding
\item season
\item length of list
\end{itemize}
}
\end{columns}


## Dynamic occupancy models

\begin{center}
\includegraphics[width=0.8\textwidth]{dynoc.png}\\
\end{center}

<!--
$$ z_{i,1} \sim Bern(\Psi_{i,1}), logit(\Psi_{i,1}) = x_i^T\alpha$$

$$ \Psi_{i,t} = z_{i,t-1} \times (1-\epsilon) + (1-z_{i,t-1}) \times \gamma$$

$$ logit(\epsilon_{i}) = x_i^T\beta_{\epsilon} \color{red} + \beta_{\epsilon}^{'} \times D_i$$

$$ logit(\gamma_{i}) = x_i^T\beta_{\gamma} \color{red} + \beta_{\gamma}^{'} \times D_i$$
-->

## Common myna expansion

\begin{columns}
\column{.5\textwidth}{
\begin{itemize}
\item Invasive in South Africa
\item Occupancy lower away from cities
\item Neighbourhood colonisation more important
\item Colonisation most likely from south
\item Expanding north-east
\end{itemize}
\vspace{3mm}
\hspace{1cm} \includegraphics[width=0.4\textwidth]{Common-Myna_Clement-Tang_21.jpg}\\
}
\column{.5\textwidth}{
\includegraphics[width=0.85\textwidth]{Broms_etal2016_fig.png}\\
Broms et al 2016, Ecology
}
\end{columns}


## Indices, etc.
