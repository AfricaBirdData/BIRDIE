<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BIRDIE DST: Model fitting • BIRDIE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BIRDIE DST: Model fitting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BIRDIE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01-birdie-basics.html">BIRDIE: Basics</a></li>
    <li><a class="dropdown-item" href="../articles/v02-birdie-spp-abundance.html">BIRDIE: Species abundance</a></li>
    <li><a class="dropdown-item" href="../articles/v03-birdie-spp-distributions.html">BIRDIE: Species distributions</a></li>
    <li><a class="dropdown-item" href="../articles/v04-birdie-abu-data-prep.html">BIRDIE ABU: Data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/v05-birdie-abu-model-fitting.html">BIRDIE ABU: Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v06-birdie-abu-model-diagnostics.html">BIRDIE ABU: Model diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/v07-birdie-abu-model-summary.html">BIRDIE ABU: Model summary</a></li>
    <li><a class="dropdown-item" href="../articles/v08-birdie-dst-data-prep.html">BIRDIE DST: Data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/v09-birdie-dst-model-fitting.html">BIRDIE DST: Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v10-birdie-dst-diagnostics.html">BIRDIE DST: Model diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/v11-birdie-dst-model-summary.html">BIRDIE DST: Model summary</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>BIRDIE DST: Model fitting</h1>
            
      

      <div class="d-none name"><code>v09-birdie-dst-model-fitting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The species distributions module (DST) of the BIRDIE pipeline has
four main steps: data preparation, model fitting, model diagnostics and
model summary. See the <em>BIRDIE: basics</em> and <em>BIRDIE: species
distributions</em> vignettes for general details about BIRDIE and about
the DST module, respectively. In this vignette, we will go through the
different tasks that are performed during the step of the DST module:
<strong>model fitting</strong>.</p>
<p>The main function used for model fitting is
<code><a href="../reference/ppl_fit_occu_model.html">ppl_fit_occu_model()</a></code>. This is a <code>ppl_</code> function,
and therefore it doesn’t do much processing itself (see <em>BIRDIE:
basics</em> if this is confusing), but it does call the right functions
to do the work. The output of <code><a href="../reference/ppl_fit_occu_model.html">ppl_fit_occu_model()</a></code> is
always a model fit but it will change depending on the package we have
selected in the <code><a href="../reference/configPipeline.html">configPipeline()</a></code> function. Currently, there
are two options <a href="https://github.com/doserjef/spOccupancy" class="external-link"><code>spOccupancy</code></a>
(preferred) and <a href="https://github.com/r-glennie/occuR" class="external-link"><code>occuR</code></a> (not
maintained, so probably not working).</p>
<p>In the following section, we explain the process of fitting a model
using <code>spOccupancy</code>.</p>
</div>
<div class="section level2">
<h2 id="fitting-a-model-using-the-spoccupancy-package">Fitting a model using the <code>spOccupancy</code> package<a class="anchor" aria-label="anchor" href="#fitting-a-model-using-the-spoccupancy-package"></a>
</h2>
<p>The main function used for fitting occupancy models using the
<code>spOccupancy</code> package is <code><a href="../reference/fitSpOccu.html">fitSpOccu()</a></code>, which is
found in the <code>R/utils-spOccupancy.R</code> file.</p>
<p>The <code>spOccupancy</code> package gives us the option to fit
single season and multi-season occupancy models. We are
<strong>currently only fitting single season models</strong>, because
there are quite a lot of data in a single season and therefore
multi-season models would demand large amounts of computing resources.
Although we could think of setting up analyses on a high-performance
computing facility, we would like to keep hardware requirements at
reasonable levels for any institution to be able to run the pipeline. In
addition, we plan to update the pipeline yearly and therefore it seems
reasonable to run single season models with the new data.</p>
<p>We also have the option to run models with or without spatial random
effects. We are <strong>currently running models without spatial
effects</strong>. We are using around 10 environmental covariates in our
models and our diagnostics indicate that are not necessary. The pipeline
could accommodate spatial models and the code structure is there to
implement them. However, it would require some work to finalise the
code.</p>
<p>The <code><a href="../reference/fitSpOccu.html">fitSpOccu()</a></code> function with some helpers (also found
in <code>R/utils-spOccupancy.R</code>) performs several tasks:</p>
<ol style="list-style-type: decimal">
<li><p>Format the site and visit data to fit in the
<code>spOccupancy</code> package. The function
<code><a href="../reference/prepSpOccuData_single.html">prepSpOccuData_single()</a></code> does this at the moment, because we
are running single-season models. There is an homologous
<code><a href="../reference/prepSpOccuData_multi.html">prepSpOccuData_multi()</a></code> for multi-season models, but it
probably needs some edits to work. These functions are basically
wrappers around <a href="https://github.com/AfricaBirdData/ABAP/blob/main/R/abapToSpOcc_single.R" class="external-link"><code>ABAP::abapToSpOcc_single()</code></a>
and <a href="https://github.com/AfricaBirdData/ABAP/blob/main/R/abapToSpOcc_multi.R" class="external-link"><code>ABAP::abapToSpOcc_multi()</code></a>.</p></li>
<li><p>Define priors and initial values. For species we don’t have any
models fit, we use the default priors from <code>spOccupancy</code> (see
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/PGOcc.html" class="external-link">?spOccupancy::PGOcc</a></code> for details). However, if we have model
fits for previous years, we center the priors in the previous parameter
estimate (if it exists - we might have fitted a different model - more
of this later) and use the standard deviation of the estimate plus one,
unless it is larger than the <code>spOccupancy</code> default (~
sqrt(2.5)), in which case we use the latter. An important function to
this is <code>defineSpOccuPriors()</code> (in
<code>R/utils-spOccupancy.R</code>).</p></li>
<li><p>Run the model. We fit the model using
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/PGOcc.html" class="external-link">spOccupancy::PGOcc()</a></code> since we are not currently using
spatial effects. If we did, then we would use
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/spPGOcc.html" class="external-link">spOccupancy::spPGOcc()</a></code>. Finally, we add information about
priors and covariate scales to the model fit to be used in other
operations later.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="different-models-for-different-species-and-years">Different models for different species and years<a class="anchor" aria-label="anchor" href="#different-models-for-different-species-and-years"></a>
</h2>
<p>It might be the case that the first model we try does not converge or
does not fit the data well (see vignette about diagnostics). At the
moment of writing we have defined two models: one with random effects
for observer, and one with random effects for observers and sites on
detection probabilities. The idea is, we first try the simplest model
and if there are issues we gradually increase complexity. These two
models work fine for now, but in the future we might want to implement
others.</p>
<p>The procedure to run multiple models at the moment manual. We define
the models we want to try in the control script (see the <em>BIRDIE:
species distributions</em> vignette), we run the pipeline for all
species in a given year with the first model, then we run diagnostics,
select problem species, then run the pipeline for those problem species
with the second model. This process can surely be automated, but the
functionality still needs to be developed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by BIRDIE Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
