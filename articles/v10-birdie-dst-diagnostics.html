<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BIRDIE">
<title>BIRDIE DST: Model diagnostics • BIRDIE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BIRDIE DST: Model diagnostics">
<meta property="og:description" content="BIRDIE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BIRDIE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v01-birdie-basics.html">BIRDIE: Basics</a>
    <a class="dropdown-item" href="../articles/v02-birdie-spp-abundance.html">BIRDIE: Species abundance</a>
    <a class="dropdown-item" href="../articles/v03-birdie-spp-distributions.html">BIRDIE: Species distributions</a>
    <a class="dropdown-item" href="../articles/v04-birdie-abu-data-prep.html">BIRDIE ABU: Data preparation</a>
    <a class="dropdown-item" href="../articles/v05-birdie-abu-model-fitting.html">BIRDIE ABU: Model fitting</a>
    <a class="dropdown-item" href="../articles/v06-birdie-abu-model-diagnostics.html">BIRDIE ABU: Model diagnostics</a>
    <a class="dropdown-item" href="../articles/v07-birdie-abu-model-summary.html">BIRDIE ABU: Model summary</a>
    <a class="dropdown-item" href="../articles/v08-birdie-dst-data-prep.html">BIRDIE DST: Data preparation</a>
    <a class="dropdown-item" href="../articles/v09-birdie-dst-model-fitting.html">BIRDIE DST: Model fitting</a>
    <a class="dropdown-item" href="../articles/v10-birdie-dst-diagnostics.html">BIRDIE DST: Model diagnostics</a>
    <a class="dropdown-item" href="../articles/v11-birdie-dst-model-summary.html">BIRDIE DST: Model summary</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>BIRDIE DST: Model diagnostics</h1>
            
      
      
      <div class="d-none name"><code>v10-birdie-dst-diagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The species distributions module (DST) of the BIRDIE pipeline has
four main steps: data preparation, model fitting, model diagnostics and
model summary. See the <em>BIRDIE: basics</em> and <em>BIRDIE: species
distributions</em> vignettes for general details about BIRDIE and about
the DST module, respectively. In this vignette, we will go through the
different tasks that are performed during the step of the DST module:
<strong>model diagnostics</strong>.</p>
<p>The main function used for model diagnosis is
<code><a href="../reference/ppl_diagnose_occu.html">ppl_diagnose_occu()</a></code>. This is a <code>ppl_</code> function,
and therefore it doesn’t do much processing itself (see <em>BIRDIE:
basics</em> if this is confusing), but it does call the right functions
to do the work.</p>
<p>During the diagnostics step we look at two indicators: the
Gelman-Rubin convergence diagnostic (<span class="math inline">\(\hat{R}\)</span>) and a goodness-of-fit Bayesian
p-value. The first diagnostic is computed by the function
<code><a href="../reference/diagnoseRhatSpOccu.html">diagnoseRhatSpOccu()</a></code> and the second one by the function
<code><a href="../reference/diagnoseGofSpOccu.html">diagnoseGofSpOccu()</a></code> (both functions are found in
<code>R/utils-spOccupancy.R</code>).</p>
<p><code><a href="../reference/ppl_diagnose_occu.html">ppl_diagnose_occu()</a></code> combines the output of these two
functions into a single table that is stored in
<code>analysis/output/sp_code/occu_diagnostics_spOccupancy_YYYY_sp_code.csv</code>,
where <code>YYYY</code> is the year of the data we are fitting a model
to and <code>sp_code</code> is the species code. In this way, it is easy
to extract all diagnostic files from the different directories, combine
them into a table and quickly explore potential issues.</p>
</div>
<div class="section level2">
<h2 id="diagnosing-convergence">Diagnosing convergence<a class="anchor" aria-label="anchor" href="#diagnosing-convergence"></a>
</h2>
<p>The function <code><a href="../reference/diagnoseRhatSpOccu.html">diagnoseRhatSpOccu()</a></code> extracts <span class="math inline">\(\hat{R}\)</span> values computed by
<code>spOccupancy</code> for each of the estimated parameters and
tabulates them. In this table, each parameter appears in one column and
gets a 0 if <span class="math inline">\(|1 - \hat{R}| &lt; 0.1\)</span>
and a 1 otherwise. Some extra columns are added, such as number of
non-convergent parameters, number of detections observed, number of
sites visited, etc.</p>
</div>
<div class="section level2">
<h2 id="diagnosing-goodness-of-fit">Diagnosing goodness-of-fit<a class="anchor" aria-label="anchor" href="#diagnosing-goodness-of-fit"></a>
</h2>
<p>The function <code><a href="../reference/diagnoseGofSpOccu.html">diagnoseGofSpOccu()</a></code> conducts posterior
predictive checks (PPC) and calculates a Bayesian p-value. This function
is a modification of the <code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/ppcOcc.html" class="external-link">spOccupancy::ppcOcc()</a></code> making a
slightly more efficient use of RAM memory, but at the expense of adding
some dependencies (on which BIRDIE already depended anyway, notably <a href="https://github.com/tidyverse/dplyr" class="external-link"><code>dplyr</code></a>).</p>
<p>The procedure to estimate the Bayesian p-value is the same used by
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/ppcOcc.html" class="external-link">spOccupancy::ppcOcc()</a></code>. However
<code><a href="../reference/diagnoseGofSpOccu.html">diagnoseGofSpOccu()</a></code> only conducts chi-squared test at the
moment, and it only aggregates data per site and not per visit. With
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/ppcOcc.html" class="external-link">spOccupancy::ppcOcc()</a></code> one can aggregate data per site or
visit and conduct Freeman-Tuckey and Chi-squared tests.</p>
<p>The procedure consists of simulating a number of
detection/non-detection data sets from the posterior distribution and
comparing the number of simulated detections, with the number of
detections actually observed in the data (see Doser et al. 2022 and
references therein). Each visit results in either detection or
non-detection, so what we really compare is the number of detections in
each site (i.e., we aggregate detections by site).</p>
<p>To make the comparison we first calculate a Chi-squared statistic for
the data, for each Monte Carlo Markov Chain (MCMC) iteration <span class="math inline">\(i\)</span></p>
<p><span class="math display">\[\chi_{obs}^{2(i)} =
\sum_{y=1}^N\frac{(\textrm{Observed}_y -
\textrm{Expected}_y^{(i)})^2}{\textrm{Expected}_y^{(i)}}\]</span> where
<span class="math inline">\(\textrm{Observed}_y\)</span> is the number
of detections observed at site <span class="math inline">\(y\)</span>
and <span class="math inline">\(\textrm{Expected}_y^{(i)}\)</span> is
the expected number of detections estimated for site <span class="math inline">\(y\)</span> during MCMC iteration <span class="math inline">\(i\)</span>.</p>
<p>We do the same thing with the simulated data sets. For the data set
simulated from MCMC iteration <span class="math inline">\(i\)</span> we
compute</p>
<p><span class="math display">\[\chi_{sim}^{2(i)} =
\sum_{y=1}^N\frac{(\textrm{sim}_y^{(i)} -
\textrm{Expected}_y^{(i)})^2}{\textrm{Expected}_y^{(i)}}\]</span> A
Bayesian p-value is computed as the proportion of <span class="math inline">\(\chi_{sim}^{2} &gt; \chi_{obs}^{2}\)</span>.</p>
</div>
<div class="section level2">
<h2 id="shiny-apps">Shiny apps<a class="anchor" aria-label="anchor" href="#shiny-apps"></a>
</h2>
<p>We have developed a Shiny app that allows us to extract diagnostics
for any species and year and explore them in an interactive way. The app
is still experimental and can be found at
<code>analysis/tools/diagnose_dst</code></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by BIRDIE Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
