<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BIRDIE DST: Model diagnostics • BIRDIE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BIRDIE DST: Model diagnostics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BIRDIE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01-birdie-basics.html">BIRDIE: Basics</a></li>
    <li><a class="dropdown-item" href="../articles/v02-birdie-spp-abundance.html">BIRDIE: Species abundance</a></li>
    <li><a class="dropdown-item" href="../articles/v03-birdie-spp-distributions.html">BIRDIE: Species distributions</a></li>
    <li><a class="dropdown-item" href="../articles/v04-birdie-abu-data-prep.html">BIRDIE ABU: Data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/v05-birdie-abu-model-fitting.html">BIRDIE ABU: Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v06-birdie-abu-model-diagnostics.html">BIRDIE ABU: Model diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/v07-birdie-abu-model-summary.html">BIRDIE ABU: Model summary</a></li>
    <li><a class="dropdown-item" href="../articles/v08-birdie-dst-data-prep.html">BIRDIE DST: Data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/v09-birdie-dst-model-fitting.html">BIRDIE DST: Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v10-birdie-dst-diagnostics.html">BIRDIE DST: Model diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/v11-birdie-dst-model-summary.html">BIRDIE DST: Model summary</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>BIRDIE DST: Model diagnostics</h1>
            
      

      <div class="d-none name"><code>v10-birdie-dst-diagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The species distributions module (DST) of the BIRDIE pipeline has
four main steps: data preparation, model fitting, model diagnostics and
model summary. See the <em>BIRDIE: basics</em> and <em>BIRDIE: species
distributions</em> vignettes for general details about BIRDIE and about
the DST module, respectively. In this vignette, we will go through the
different tasks that are performed during the step of the DST module:
<strong>model diagnostics</strong>.</p>
<p>The main function used for model diagnosis is
<code><a href="../reference/ppl_diagnose_occu.html">ppl_diagnose_occu()</a></code>. This is a <code>ppl_</code> function,
and therefore it doesn’t do much processing itself (see <em>BIRDIE:
basics</em> if this is confusing), but it does call the right functions
to do the work.</p>
<p>During the diagnostics step we look at two indicators: the
Gelman-Rubin convergence diagnostic
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>R</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{R}</annotation></semantics></math>)
and a goodness-of-fit Bayesian p-value. The first diagnostic is computed
by the function <code><a href="../reference/diagnoseRhatSpOccu.html">diagnoseRhatSpOccu()</a></code> and the second one by
the function <code><a href="../reference/diagnoseGofSpOccu.html">diagnoseGofSpOccu()</a></code> (both functions are found
in <code>R/utils-spOccupancy.R</code>).</p>
<p><code><a href="../reference/ppl_diagnose_occu.html">ppl_diagnose_occu()</a></code> combines the output of these two
functions into a single table that is stored in
<code>analysis/output/sp_code/occu_diagnostics_spOccupancy_YYYY_sp_code.csv</code>,
where <code>YYYY</code> is the year of the data we are fitting a model
to and <code>sp_code</code> is the species code. In this way, it is easy
to extract all diagnostic files from the different directories, combine
them into a table and quickly explore potential issues.</p>
</div>
<div class="section level2">
<h2 id="diagnosing-convergence">Diagnosing convergence<a class="anchor" aria-label="anchor" href="#diagnosing-convergence"></a>
</h2>
<p>The function <code><a href="../reference/diagnoseRhatSpOccu.html">diagnoseRhatSpOccu()</a></code> extracts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>R</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{R}</annotation></semantics></math>
values computed by <code>spOccupancy</code> for each of the estimated
parameters and tabulates them. In this table, each parameter appears in
one column and gets a 0 if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mn>1</mn><mo>−</mo><mover><mi>R</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">|</mo></mrow><mo>&lt;</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">|1 - \hat{R}| &lt; 0.1</annotation></semantics></math>
and a 1 otherwise. Some extra columns are added, such as number of
non-convergent parameters, number of detections observed, number of
sites visited, etc.</p>
</div>
<div class="section level2">
<h2 id="diagnosing-goodness-of-fit">Diagnosing goodness-of-fit<a class="anchor" aria-label="anchor" href="#diagnosing-goodness-of-fit"></a>
</h2>
<p>The function <code><a href="../reference/diagnoseGofSpOccu.html">diagnoseGofSpOccu()</a></code> conducts posterior
predictive checks (PPC) and calculates a Bayesian p-value. This function
is a modification of the <code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/ppcOcc.html" class="external-link">spOccupancy::ppcOcc()</a></code> making a
slightly more efficient use of RAM memory, but at the expense of adding
some dependencies (on which BIRDIE already depended anyway, notably <a href="https://github.com/tidyverse/dplyr" class="external-link"><code>dplyr</code></a>).</p>
<p>The procedure to estimate the Bayesian p-value is the same used by
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/ppcOcc.html" class="external-link">spOccupancy::ppcOcc()</a></code>. However
<code><a href="../reference/diagnoseGofSpOccu.html">diagnoseGofSpOccu()</a></code> only conducts chi-squared test at the
moment, and it only aggregates data per site and not per visit. With
<code><a href="https://www.jeffdoser.com/files/spoccupancy-web/reference/ppcOcc.html" class="external-link">spOccupancy::ppcOcc()</a></code> one can aggregate data per site or
visit and conduct Freeman-Tuckey and Chi-squared tests.</p>
<p>The procedure consists of simulating a number of
detection/non-detection data sets from the posterior distribution and
comparing the number of simulated detections, with the number of
detections actually observed in the data (see Doser et al. 2022 and
references therein). Each visit results in either detection or
non-detection, so what we really compare is the number of detections in
each site (i.e., we aggregate detections by site).</p>
<p>To make the comparison we first calculate a Chi-squared statistic for
the data, for each Monte Carlo Markov Chain (MCMC) iteration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>χ</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow><mrow><mn>2</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msubsup><mo>=</mo><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">Observed</mtext><mi>y</mi></msub><mo>−</mo><msubsup><mtext mathvariant="normal">Expected</mtext><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msubsup><mtext mathvariant="normal">Expected</mtext><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></mfrac></mrow><annotation encoding="application/x-tex">\chi_{obs}^{2(i)} = \sum_{y=1}^N\frac{(\textrm{Observed}_y - \textrm{Expected}_y^{(i)})^2}{\textrm{Expected}_y^{(i)}}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">Observed</mtext><mi>y</mi></msub><annotation encoding="application/x-tex">\textrm{Observed}_y</annotation></semantics></math>
is the number of detections observed at site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mtext mathvariant="normal">Expected</mtext><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\textrm{Expected}_y^{(i)}</annotation></semantics></math>
is the expected number of detections estimated for site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
during MCMC iteration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</p>
<p>We do the same thing with the simulated data sets. For the data set
simulated from MCMC iteration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
we compute</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>χ</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow><mrow><mn>2</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msubsup><mo>=</mo><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mtext mathvariant="normal">sim</mtext><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>−</mo><msubsup><mtext mathvariant="normal">Expected</mtext><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msubsup><mtext mathvariant="normal">Expected</mtext><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></mfrac></mrow><annotation encoding="application/x-tex">\chi_{sim}^{2(i)} = \sum_{y=1}^N\frac{(\textrm{sim}_y^{(i)} - \textrm{Expected}_y^{(i)})^2}{\textrm{Expected}_y^{(i)}}</annotation></semantics></math>
A Bayesian p-value is computed as the proportion of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>χ</mi><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow><mn>2</mn></msubsup><mo>&gt;</mo><msubsup><mi>χ</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\chi_{sim}^{2} &gt; \chi_{obs}^{2}</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="shiny-apps">Shiny apps<a class="anchor" aria-label="anchor" href="#shiny-apps"></a>
</h2>
<p>We have developed a Shiny app that allows us to extract diagnostics
for any species and year and explore them in an interactive way. The app
is still experimental and can be found at
<code>analysis/tools/diagnose_dst</code></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by BIRDIE Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
