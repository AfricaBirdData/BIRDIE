<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BIRDIE">
<title>BIRDIE ABU: Model fitting • BIRDIE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BIRDIE ABU: Model fitting">
<meta property="og:description" content="BIRDIE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BIRDIE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v01-birdie-basics.html">BIRDIE: Basics</a>
    <a class="dropdown-item" href="../articles/v02-birdie-spp-abundance.html">BIRDIE: Species abundance</a>
    <a class="dropdown-item" href="../articles/v03-birdie-spp-distributions.html">BIRDIE: Species distributions</a>
    <a class="dropdown-item" href="../articles/v04-birdie-abu-data-prep.html">BIRDIE ABU: Data preparation</a>
    <a class="dropdown-item" href="../articles/v05-birdie-abu-model-fitting.html">BIRDIE ABU: Model fitting</a>
    <a class="dropdown-item" href="../articles/v06-birdie-abu-model-diagnostics.html">BIRDIE ABU: Model diagnostics</a>
    <a class="dropdown-item" href="../articles/v07-birdie-abu-model-summary.html">BIRDIE ABU: Model summary</a>
    <a class="dropdown-item" href="../articles/v08-birdie-dst-data-prep.html">BIRDIE DST: Data preparation</a>
    <a class="dropdown-item" href="../articles/v09-birdie-dst-model-fitting.html">BIRDIE DST: Model fitting</a>
    <a class="dropdown-item" href="../articles/v10-birdie-dst-diagnostics.html">BIRDIE DST: Model diagnostics</a>
    <a class="dropdown-item" href="../articles/v11-birdie-dst-model-summary.html">BIRDIE DST: Model summary</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>BIRDIE ABU: Model fitting</h1>
            
      
      
      <div class="d-none name"><code>v05-birdie-abu-model-fitting.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://africabirddata.github.io/BIRDIE/">BIRDIE</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The species abundance module (ABU) of the BIRDIE pipeline has four
main steps: data preparation, model fitting, model diagnostics and model
summary. See the <em>BIRDIE: basics</em> and <em>BIRDIE: species
abundance</em> vignettes for general details about BIRDIE and about the
ABU module, respectively. In this vignette, we will go through the
different tasks that are performed during the first step of the ABU
module: <strong>data preparation</strong>.</p>
<p>The main function used for model fitting is
<code><a href="../reference/ppl_fit_ssm_model.html">ppl_fit_ssm_model()</a></code>. This is a <code>ppl_</code> function,
and therefore it doesn’t do much processing itself (see <em>BIRDIE:
basics</em> if this is confusing), but it does call the right functions
to do the work. The output of <code><a href="../reference/ppl_fit_ssm_model.html">ppl_fit_ssm_model()</a></code> is always
a model fit but it will change depending on the package we have selected
in the <code><a href="../reference/configPipeline.html">configPipeline()</a></code> function. At moment, there is only
one option, and it is to fit a state-space model using JAGS (with the
package <code>jagsUI</code>).</p>
<p>In the following section, we explain the process of fitting a model
using <code>jagsUI</code>.</p>
</div>
<div class="section level2">
<h2 id="fitting-a-model-using-the-jagsui-package">Fitting a model using the <code>jagsUI</code> package<a class="anchor" aria-label="anchor" href="#fitting-a-model-using-the-jagsui-package"></a>
</h2>
<p>At the moment there is only the option of fitting a state-space model
using the <code>jagsUI</code> package and therefore it is the main
<code><a href="../reference/ppl_fit_ssm_model.html">ppl_fit_ssm_model()</a></code> that takes care of this (i.e., there is
no package specific function for fitting the model - although we might
want to change this).</p>
<p>We use the <code><a href="https://rdrr.io/pkg/jagsUI/man/jagsbasic.html" class="external-link">jagsUI::jags.basic()</a></code> function, which outputs
raw <code>mcmc</code> samples. These outputs use less memory than the
default <code>jagsUI</code> processed outputs that compute some
additional elements, such posterior means and standard deviations.</p>
<p>We do compute those additional elements when we need them, using the
custom function <code><a href="../reference/processJAGSoutput.html">processJAGSoutput()</a></code>, which is very similar
to the internal <code>jagsUI:::processoutput()</code>. It has just been
slightly modified to remove some calculations that we don’t need and
make computations a bit lighter. This function and all other that are
design to work with JAGS are stored in the <code>R/utils-jags.R</code>
file.</p>
</div>
<div class="section level2">
<h2 id="latest-model-specification">Latest model specification<a class="anchor" aria-label="anchor" href="#latest-model-specification"></a>
</h2>
<p>State-space models are used to describe and understand dynamic
systems that may not be perfectly observed. Within this framework, we
consider waterbird abundance to be a process that evolves over time, and
which we observe during visits to CWAC sites. However, counts conducted
by observers are distorted by imperfect detection that translates into
counting errors. By counting repeatedly over time, and assuming that
abundance evolves smoothly over time compared to observation error, we
can disentangle these two processes.</p>
<p>We consider that the log of the observed counts (<span class="math inline">\(y_i\)</span>) at sampling occasion <span class="math inline">\(i\)</span> (generally there were two sampling
occasions per year, one in mid-summer and one in mid-winter), at any
given site, arise from a normal distribution, such that</p>
<p><span class="math display">\[\log{(y_i)} \sim N(\mu_i,
\sigma_i^2)\]</span></p>
<p>where <span class="math inline">\(\mu_i\)</span>is the latent
(unobserved) log abundance of waterbirds present at a site on sampling
occasion <span class="math inline">\(i\)</span> and <span class="math inline">\(\sigma^2\)</span> is the corresponding variance of
the observers counting error, also in the log scale. Therefore, counts
depend both on the number of waterbirds present on site, and on errors
in the counts of these birds.</p>
<p>To model changes in waterbird abundance between the two-seasons of
year <span class="math inline">\(t\)</span>, we define <span class="math inline">\(s_t\)</span> to be the summer abundance and <span class="math inline">\(w_t\)</span> the winter abundance. Note that,
although we currently consider only one count per season, there could
potentially be multiple counts in a single year and season. However, the
underlying true abundance is considered to stay constant in any given
year and season (for clarity, note also that while sampling occasions
were indexed by <span class="math inline">\(i\)</span>, years are
indexed by <span class="math inline">\(t\)</span>). Thus, the expected
(log) abundance for any given count can be written as</p>
<p><span class="math display">\[\mu_{i} = s_t \textrm{summer} + w_t
\textrm{winter}\]</span></p>
<p>where ‘summer’ is an indicator variable that takes on the value 1 in
summer and 0 in winter, and ‘winter’ is the opposite. We then define
abundance dynamics as:</p>
<p><span class="math display">\[s_t = s_{t-1} + \beta_t\]</span> <span class="math display">\[w_t = s_t + \xi_t\]</span></p>
<p>where <span class="math inline">\(\beta_t\)</span> corresponds to the
change in summer abundance from year <span class="math inline">\(t-1\)</span> to year <span class="math inline">\(t\)</span>, and <span class="math inline">\(\xi_t\)</span> is the difference between summer
and winter abundance, both in the log scale. If exponentiated, these
parameters can be interpreted as the rate of change in the population
and the winter-to-summer ratio of the population, respectively.</p>
<p>We impose relatively smooth changes in abundance by defining
autocorrelation in <span class="math inline">\(\beta_t\)</span> and
<span class="math inline">\(\xi_t\)</span> terms over time. In addition,
we define a mean reverting process whereby the populations at a certain
site tend to revert to a site-specific mean or “preferred” abundance
<span class="math inline">\(\psi_{(s)t}\)</span> in summer and <span class="math inline">\(\psi_{wt}\)</span> in winter. This specification
is important to prevent estimated populations to explode in periods with
missing data. These mean abundances may change occasionally, as we will
see below.</p>
<p>We then define the expected change in summer population (the winter
population evolves similarly) as <span class="math display">\[\zeta_t' = \psi_{(s)t} - s_t\]</span> We
define certain persistence in population trends such that <span class="math display">\[\beta_{t+1} = \beta_t + \phi_s(\zeta_t' -
\beta_t) + \zeta_t\]</span> where <span class="math inline">\(\zeta_t
\sim N(0, \sigma_{\zeta}^2)\)</span> and <span class="math inline">\(\phi_s\)</span> lies between zero and one, and
controls how quickly the population reverts back to the mean.</p>
<p>Finally, we define a jump process, whereby population can present
sudden changes in abundance that do not conform to the general temporal
pattern. These changes are frequent in waterbird populations and,
although possibly associated the conditions at the sites, it is
challenging to understand the drivers behind them. We define</p>
<p><span class="math display">\[\textrm{jump}_{(s)t} =
\textrm{I}_{(s)t}z_{(s)t}\]</span> where <span class="math inline">\(\textrm{I}_{(s)t} \sim
\textrm{Bernoulli}(p_s)\)</span> and <span class="math inline">\(z_{(s)t} \sim N(0, \sigma_{jump_s}^2)\)</span>. We
make <span class="math inline">\(p_s\)</span> be a small probability
(with its prior) and <span class="math inline">\(\sigma_{jump_s}\)</span> large relative to <span class="math inline">\(\sigma_{\zeta}\)</span> to favour few, large jumps
rather than frequent small ones.</p>
<p>These jumps in the population may stick for some time, meaning that
they affect the mean abundance of the sites. Therefore, once a jump in a
population is observed, the new level becomes the mean and we need a new
jump to go back to the original mean. In this way we ensure that
deviating from the mean and coming back to it are captured as two
separate jumps and not necessarily as a jump and a mean reversion.
Therefore,</p>
<p><span class="math display">\[\psi_{(s)t+1} = \psi_{(s)t} +
\textrm{jump}_{(s)t}\]</span> In order to capture population jumps in
the changes represented by <span class="math inline">\(\beta\)</span> we
set</p>
<p><span class="math display">\[\beta_{t} = \beta_{t} +
\textrm{jump}_{(s)t}\]</span></p>
<p>Note that this is for reporting purposes only, which is important
because we don’t want jumps to be considered in the update step for
<span class="math inline">\(\beta_t\)</span> (see expression above for
_{t+1}).</p>
<p>The model for the winter population is similar to the summer one</p>
<p><span class="math display">\[\xi_t' = \psi_{(w)t} -
s_{t+1}\]</span></p>
<p>represents the expected change in winter population on year <span class="math inline">\(t+1\)</span>, and the actual change is given
by</p>
<p><span class="math display">\[\lambda_{t+1} = \lambda_t +
\phi_w(\xi_t' - \lambda_t) + \xi_t\]</span> where <span class="math inline">\(\xi_t \sim N(0, \sigma_{\xi}^2)\)</span> and <span class="math inline">\(\phi_w\)</span> lies between zero and one, and
controls how quickly the population reverts back to the mean.</p>
<p>There can also be jumps in the winter populations given by</p>
<p><span class="math display">\[\textrm{jump}_{(w)t} =
\textrm{I}_{(w)t}z_{(w)t}\]</span> where <span class="math inline">\(\textrm{I}_{(w)t} \sim
\textrm{Bernoulli}(p_w)\)</span> and <span class="math inline">\(z_{(w)t} \sim N(0, \sigma_{jump_w}^2)\)</span>. We
make <span class="math inline">\(p_w\)</span> be a small probability
(with its prior) and <span class="math inline">\(\sigma_{jump_s}\)</span> large relative to <span class="math inline">\(\sigma_{\xi}\)</span>.</p>
<p>These jumps may also stick to the population as</p>
<p><span class="math display">\[\psi_{(w)t+1} = \psi_{(w)t} +
\textrm{jump}_{(w)t}\]</span> And they are incorporated into <span class="math inline">\(\lambda_t\)</span> for reporting purposes, such
that</p>
<p><span class="math display">\[\lambda_{t} = \lambda_{t} +
\textrm{jump}_{(w)t}\]</span></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by BIRDIE Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
