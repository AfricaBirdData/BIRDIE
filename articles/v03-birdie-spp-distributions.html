<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BIRDIE: Species distributions • BIRDIE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BIRDIE: Species distributions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BIRDIE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01-birdie-basics.html">BIRDIE: Basics</a></li>
    <li><a class="dropdown-item" href="../articles/v02-birdie-spp-abundance.html">BIRDIE: Species abundance</a></li>
    <li><a class="dropdown-item" href="../articles/v03-birdie-spp-distributions.html">BIRDIE: Species distributions</a></li>
    <li><a class="dropdown-item" href="../articles/v04-birdie-abu-data-prep.html">BIRDIE ABU: Data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/v05-birdie-abu-model-fitting.html">BIRDIE ABU: Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v06-birdie-abu-model-diagnostics.html">BIRDIE ABU: Model diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/v07-birdie-abu-model-summary.html">BIRDIE ABU: Model summary</a></li>
    <li><a class="dropdown-item" href="../articles/v08-birdie-dst-data-prep.html">BIRDIE DST: Data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/v09-birdie-dst-model-fitting.html">BIRDIE DST: Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v10-birdie-dst-diagnostics.html">BIRDIE DST: Model diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/v11-birdie-dst-model-summary.html">BIRDIE DST: Model summary</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>BIRDIE: Species distributions</h1>
            
      

      <div class="d-none name"><code>v03-birdie-spp-distributions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>There are two main analytical modules in BIRDIE: the distribution and
abundance modules.</p>
<p>In this document we will see how to use the distribution (DST)
module. To do this we will have a look at the control script used to run
the module and then we will break down its different sections to
understand what all the functions involved in this analysis do.</p>
</div>
<div class="section level2">
<h2 id="the-control-script">The control script<a class="anchor" aria-label="anchor" href="#the-control-script"></a>
</h2>
<p>The control script can be found at
<code>/analysis/scripts/pipeline_script_dst.R</code>. This script has
three parts:</p>
<ul>
<li>Configuration</li>
<li>Create logs</li>
<li>Run modules</li>
</ul>
<p>We will go through each of these parts below.</p>
<p>The script is really just a for loop over species in which the main
pipeline function for the distribution module
<code><a href="../reference/ppl_run_pipe_dst1.html">ppl_run_pipe_dst1()</a></code> is executed. This means that we are
only interested in one species we can go ahead and use the
<code><a href="../reference/ppl_run_pipe_dst1.html">ppl_run_pipe_dst1()</a></code> function.</p>
<p>To run the distribution module of the pipeline, it is enough to just
run the script. However, the default values will run the full pipeline
for all species, and for several years, which might take quite long. We
will now go through the different steps the pipeline goes through to
better understand how to configure it to do what we want.</p>
<p>Note that while this is the default script we use for running the
pipeline, there is nothing special about it, and we could use something
different that suits our needs.</p>
<div class="section level3">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># We are currently working with several detection models</span></span>
<span><span class="va">det_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det_mod1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(1|obs_id)"</span>, <span class="st">"log_hours"</span>, <span class="st">"prcp"</span>, <span class="st">"tdiff"</span>, <span class="st">"cwac"</span><span class="op">)</span>,</span>
<span>                 det_mod2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(1|obs_id)"</span>, <span class="st">"(1|site_id)"</span>, <span class="st">"log_hours"</span>, <span class="st">"prcp"</span>, <span class="st">"tdiff"</span>, <span class="st">"cwac"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure pipeline</span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configPipeline.html">configPipeline</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>                         dur <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                         occ_mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log_dist_coast"</span>, <span class="st">"elev"</span>, <span class="st">"log_hum.km2"</span>, <span class="st">"wetcon"</span>,</span>
<span>                                     <span class="st">"watrec"</span>, <span class="st">"watext"</span>, <span class="st">"log_watext"</span>, <span class="st">"watext:watrec"</span>,</span>
<span>                                     <span class="st">"ndvi"</span>, <span class="st">"prcp"</span>, <span class="st">"tdiff"</span><span class="op">)</span>,</span>
<span>                         det_mod <span class="op">=</span> <span class="va">det_mods</span><span class="op">$</span><span class="va">det_mod1</span>,</span>
<span>                         fixed_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pentad"</span>, <span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"watocc_ever"</span>, <span class="st">"wetext_2018"</span>,<span class="st">"wetcon_2018"</span>,</span>
<span>                                        <span class="st">"dist_coast"</span>, <span class="st">"elev"</span><span class="op">)</span>,</span>
<span>                         package <span class="op">=</span> <span class="st">"spOccupancy"</span>,</span>
<span>                         data_dir <span class="op">=</span> <span class="st">"analysis/data"</span>,     <span class="co"># this might have to be adapted?</span></span>
<span>                         out_dir <span class="op">=</span> <span class="st">"analysis/output"</span>,    <span class="co"># this might have to be adapted?</span></span>
<span>                         server <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In the piece of code above, we list a couple of possible detection
models that we can choose from (handy if we are planning of conducting
several runs of the pipeline with different models), and then we create
a <code>config</code> object that will be used throughout the pipeline
by several functions.</p>
<p>The <code><a href="../reference/configPipeline.html">configPipeline()</a></code> function, allows us to let the
pipeline know what models we want to run, for what years, what packages
we want to use, etc. For detailed information see
<code><a href="../reference/configPipeline.html">?configPipeline</a></code>.</p>
<p>(Note: there might be a better way of doing this, such as creating
environment variables or something like this, but this works for
now)</p>
</div>
<div class="section level3">
<h3 id="create-logs">Create logs<a class="anchor" aria-label="anchor" href="#create-logs"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Create log?</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/createLog.html">createLog</a></span><span class="op">(</span><span class="va">config</span>, log_file <span class="op">=</span> <span class="cn">NULL</span>, date_time <span class="op">=</span> <span class="cn">NULL</span>, species <span class="op">=</span> <span class="cn">NA</span>, model <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                  year <span class="op">=</span> <span class="cn">NA</span>, data <span class="op">=</span> <span class="cn">NA</span>, fit <span class="op">=</span> <span class="cn">NA</span>, diagnose <span class="op">=</span> <span class="cn">NA</span>, summary <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                  package <span class="op">=</span> <span class="cn">NA</span>, notes <span class="op">=</span> <span class="st">"Log file created"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span></code></pre></div>
<p>The pipeline has a system to log all its activity. This is useful to
keep track of what species and years the pipeline has run for and
whether there have been any problems (e.g., species with too few data
points or model fit errors). All the activity is stored in .csv files
that are saved to <code>analysis/output/reports</code>.</p>
<p>For more information check the logging functions of the BIRDIE
package that are stored on the <code>utils.R</code> file, notably see
<code>?createLog()</code> for general logs and
<code>?logFitStatus()</code> for logs of model runs.</p>
<p>We see that for if we run the pipeline for several species, it makes
sense to create a log file only for the first species (that is why
<code>if(i == 1)</code>), and then use this file to store information
for all species, each in one row of the .csv file. If we just created
one log for each species, then there would be one .csv log file for each
species. The past this first setup phase, the pipeline will look for the
most recent log file and add information to it, regardless of whether
information is already present or not.</p>
</div>
<div class="section level3">
<h3 id="run-modules">Run modules<a class="anchor" aria-label="anchor" href="#run-modules"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">config</span><span class="op">$</span><span class="va">years</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">year_sel</span> <span class="op">&lt;-</span> <span class="va">config</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">out_dst1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ppl_run_pipe_dst1.html">ppl_run_pipe_dst1</a></span><span class="op">(</span>sp_code <span class="op">=</span> <span class="va">sp_code</span>,</span>
<span>                                  year <span class="op">=</span> <span class="va">year_sel</span>,</span>
<span>                                  config <span class="op">=</span> <span class="va">config</span>,</span>
<span>                                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"fit"</span>, <span class="st">"summary"</span>, <span class="st">"diagnose"</span><span class="op">)</span>,</span>
<span>                                  force_gee_dwld <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  monitor_gee <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  force_site_visit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  force_abap_dwld <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  spatial <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  print_fitting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Pipeline DST1 status ="</span>, <span class="va">out_dst1</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">out_dst1</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw">next</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The final part of the script runs the modules of the pipeline that we
are interested in (currently there is only one, because “module 2 - Area
of Occupancy and other derived indicators”, is now run by the data
base). It will loop through the different years that we have set during
the configuration phase and it will run the main function of the
distribution module <code><a href="../reference/ppl_run_pipe_dst1.html">ppl_run_pipe_dst1()</a></code>. This function can
run all the steps of the module: data preparation, model fitting, model
diagnostics and model summary, or it can run just some of them. It will
use the <code>config</code> object to know what package it should use
for model fitting and the paths to store model-ready data and model
outputs. Note that some of the steps, may take quite long. For example,
to prepare data the pipeline connects to Google Earth Engine and
annotates data with environmental covariates, which can take a while. It
also requires an internet connection. Keep this in mind and note that we
can skip some of the steps using the right arguments. For more
information see <code><a href="../reference/ppl_run_pipe_dst1.html">?ppl_run_pipe_dst1</a></code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by BIRDIE Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
